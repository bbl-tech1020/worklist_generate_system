{% extends 'dashboard/index.html' %}
{% load static %}

{% block header %}
<header class="navbar navbar-expand-md navbar-light d-print-none">
  <div class="container-fluid">
    <h1 class="navbar-brand">文件下载</h1>
  </div>
</header>
<style>
  ul {
    list-style: none;
    padding-left: 20px
  }

  .folder {
    cursor: pointer;
    font-weight: 700;
    font-size: 18px;
    margin: 8px 0
  }

  .file {
    margin-left: 25px;
    font-size: 16px;
    color: #333;
    margin-top: 8px;
    display: block
  }

  .hidden {
    display: none
  }

  /* 仅放大最外层（平台级：NIMBUS、Starlet）之间的间距 */
  #fileTree>ul>li {
    margin: 30px 0;
    /* 想要多大就写多大 */
  }
</style>
{% endblock %}

{% block content %}
<div id="fileTree">
  <ul>
    {% for g in groups %}
    <li>
      <span class="folder">📁 {{ g.group }}</span>
      <ul class="hidden">
        {% for day in g.days %}
        <li>
          <span class="folder">📁 {{ day.date }}</span>
          <ul class="hidden">
            {% for proj in day.projects %}
            <li>
              <span class="folder">📁 {{ proj.name }}</span>
              <ul class="hidden">
                {% for f in proj.files %}
                {% if f.is_pdf %}
                <li><a class="file" href="{{ f.url }}" download="{{ f.name }}">📄 {{ f.name }}</a></li>
                {% else %}
                <li><a class="file" href="{{ f.url }}" target="_blank">📄 {{ f.name }}</a></li>
                {% endif %}
                {% empty %}
                <li class="file">（暂无文件）</li>
                {% endfor %}
              </ul>
            </li>
            {% endfor %}
          </ul>
        </li>
        {% empty %}
        <li class="file">（暂无文件）</li>
        {% endfor %}
      </ul>
    </li>
    {% empty %}
    <li>暂无导出文件</li>
    {% endfor %}
  </ul>
</div>

<script>
  document.querySelectorAll("#fileTree .folder").forEach(el => {
    el.addEventListener("click", () => {
      const next = el.nextElementSibling;
      if (next) next.classList.toggle("hidden");
    });
  });
</script>
{% endblock %}